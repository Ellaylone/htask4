{"version":3,"sources":["main.js","draw.js","input.js","subs.js"],"names":["Modal","el","this","element","status","ModalAlert","apply","arguments","contentEl","querySelector","closeEl","addEventListener","hide","bind","showPlayer","linksEl","classList","add","playerEl","remove","initCanvas","canvasStartState","canvas","e","clickedX","pageX","target","offsetLeft","clickedY","pageY","offsetTop","controlElements","some","right","left","top","bottom","onCanvasClick","type","elType","isSubtitleShown","drawSub","subtitles","subtitleIndex","startSubTimeout","video","play","audio","createPauseElement","stopSubTimeout","pause","stopDrawLoop","drawCenterPlayButton","canvasControlsColor","createStartElement","width","height","canvasResize","canvasWidth","canvasHeight","window","screen","videoWidth","videoSizeRatio","videoHeight","drawBackground","canvasBgColor","grayAndGrain","imageData","pixels","data","value","i","length","Math","random","r","g","b","v","color","ctx","fillStyle","fillRect","triangle","points","x","y","push","beginPath","moveTo","lineTo","fill","drawSkratches","strokeOpacity","strokeStyle","amountOfSkratches","floor","skratch","startPoint","endPoint","stroke","startDrawLoop","loopId","subTimeout","setTimeout","hideSub","timeLength","setInterval","drawLoop","fps","clearInterval","undefined","clearRect","drawImage","getImageData","imageDataFiltered","putImageData","_onInputFocus","setSelectionRange","_onLinksFormSubmit","preventDefault","overlay","show","loader","inputs","document","querySelectorAll","validation","forEach","input","Promise","all","createVideo","videoInput","createAudio","audioInput","createSub","subInput","then","res","parseSrt","err","modalAlert","src","resolve","reject","subReq","XMLHttpRequest","readyState","responseText","open","send","createElement","setAttribute","corsProxy","defaultMuted","style","visibility","time","currentTime","toFixed","endTime","showSub","appendChild","parseInt","getComputedStyle","display","autoplay","text","timeConst","sec","min","hr","temp","split","result","map","subtitle","number","startTime","startTimeSec","join","startTimeMin","startTimeHr","endTimeSec","endTimeMin","endTimeHr","splice","content","Subtitle","sub","font","canvasFontSize","textHeight","canvasLineHeight","topPadding","fillText","clearTimeout","prototype","toggle","contains","Object","create","constructor","setContent","innerHTML","canvasFontColor","linksForm","submitEl","linksFormInputs","reader","FileReader","srt","getContext","loaderStatus"],"mappings":"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","file":"main.js","sourcesContent":["window.addEventListener('load', (e) => {\n    setTimeout(() => {\n        loader.hide();\n        overlay.hide();\n    }, 2000);\n});\n\nwindow.addEventListener('resize', (e) => {\n    if(loopId) {\n        onCanvasClick('pause');\n    }\n    canvasStartState();\n}, false);\n\nfunction Modal (el) {\n    this.element = el;\n    this.status = false\n}\n\nModal.prototype.hide = function () {\n    this.element.classList.add('hidden');\n    this.status = false;\n}\n\nModal.prototype.show = function () {\n    this.element.classList.remove('hidden');\n    this.status = true;\n}\n\nModal.prototype.toggle = function () {\n    this.element.classList.toggle('hidden');\n    if(this.element.classList.contains('hidden')) {\n        this.status = false;\n    } else {\n        this.status = true;\n    }\n}\n\nfunction ModalAlert (el) {\n    Modal.apply(this, arguments);\n    this.contentEl = this.element.querySelector('.alert__content');\n    this.closeEl = this.element.querySelector('.close');\n\n    this.closeEl.addEventListener('click', this.hide.bind(this), false);\n}\n\nModalAlert.prototype = Object.create(Modal.prototype);\nModalAlert.prototype.constructor = ModalAlert;\n\nModalAlert.prototype.show = function (content) {\n    this.setContent(content);\n    Modal.prototype.show.apply(this, arguments);\n}\n\nModalAlert.prototype.setContent = function (content) {\n    this.contentEl.innerHTML = content;\n}\n\n\n// main\nconst canvasBgColor = '#000',\n      canvasControlsColor = '#fff',\n      canvasFontColor = '#fff',\n      canvasFontSize = 24,\n      canvasLineHeight = 12;\n\nconst linksForm = document.querySelector('.links-form'),\n      linksEl = document.querySelector('.links'),\n      playerEl = document.querySelector('.player'),\n      submitEl = document.querySelector('.links-form__submit'),\n\n      linksFormInputs = document.querySelectorAll('.links-form__input'),\n      videoInput = document.querySelector('.links-form__video'),\n      audioInput = document.querySelector('.links-form__audio'),\n      subInput = document.querySelector('.links-form__sub');\n\nconst fps = 1000 / 60;\n\nlet video, canvas, audio;\ncanvas = document.querySelector('.player__canvas');\n\nlet controlElements = [],\n    reader = new FileReader(),\n    srt;\n\nlet videoWidth,\n    videoHeight,\n    videoSizeRatio;\n\nlet isSubtitleShown = false,\n    subtitles,\n    subTimeout,\n    subtitleIndex = 0;\n\nlet ctx = canvas.getContext('2d');\nlet loopId;\n\nlet loaderStatus = false;\n    \nlet loader = new Modal(document.querySelector('.loader-wrap'));\nlet overlay = new Modal(document.querySelector('.overlay'));\nlet modalAlert = new ModalAlert(document.querySelector('.alert'));\noverlay.element.addEventListener('click', (e) => {\n    if(modalAlert.status){\n        modalAlert.hide();\n        overlay.hide();\n    }\n}, false);\n\nlet corsProxy = 'http://cors.io/?u=';\n\nfunction showPlayer () {\n    linksEl.classList.add('hidden');\n    playerEl.classList.remove('hidden');\n}\n\nfunction initCanvas () {\n    canvasStartState();\n\n    canvas.addEventListener('click', (e) => {\n        let clickedX = e.pageX - e.target.offsetLeft;\n        let clickedY = e.pageY - e.target.offsetTop;\n        \n        controlElements.some((el) => {\n            if (clickedX < el.right && clickedX > el.left && clickedY > el.top && clickedY < el.bottom) {\n                onCanvasClick(el.type);\n\n            }\n        });\n    }, false);\n}\n\nfunction onCanvasClick (elType) {\n    if(elType == 'start'){\n        if(!isSubtitleShown) {\n            video.play();\n        } else {\n            drawSub(subtitles[subtitleIndex]);\n            startSubTimeout();\n        }\n        audio.play();\n        createPauseElement();        \n    } else {\n        if(!isSubtitleShown){\n            video.pause();\n            stopDrawLoop();\n            drawCenterPlayButton(canvasControlsColor);\n        } else {\n            drawSub(subtitles[subtitleIndex]);\n            stopSubTimeout();\n        }\n        audio.pause();\n        controlElements = [];\n        createStartElement();\n    }\n}\n\nfunction createStartElement () {\n    controlElements = [{\n        type: 'start',\n        top: 0,\n        left: 0,\n        right: canvas.width,\n        bottom: canvas.height\n    }];\n}\n\nfunction createPauseElement () {\n    controlElements = [{\n        type: 'pause',\n        top: 0,\n        left: 0,\n        right: canvas.width,\n        bottom: canvas.height\n    }];\n}\n\nfunction canvasResize () {\n    let canvasWidth, canvasHeight;\n    if(window.screen.width < window.screen.height) {\n        if(window.screen.width > videoWidth) {\n            canvasWidth = videoWidth;\n        } else {\n            canvasWidth = window.screen.width;\n        }\n        canvasHeight = canvasWidth / videoSizeRatio;\n    } else {\n        if(window.screen.height > videoHeight) {\n            canvasHeight = videoHeight;\n        } else {\n            canvasHeight = window.screen.height;\n        }\n        canvasWidth = canvasHeight * videoSizeRatio;\n    }\n    canvas.width = canvasWidth;\n    canvas.height = canvasHeight;\n}\n\nfunction canvasStartState () {\n    canvasResize();\n    drawBackground(canvasBgColor);\n    drawCenterPlayButton(canvasControlsColor);\n}\n","// делаем картинку черно белой и накладываем шум\nfunction grayAndGrain (imageData) {\n    // получаем одномерный массив, описывающий все пиксели изображения\n    let pixels = imageData.data;\n    let value;\n\n    // циклически преобразуем массив, изменяя значения красного, зеленого и синего каналов\n    for (let i = 0; i < pixels.length; i += 4) {\n        value = Math.random() + 1;\n        let r = pixels[i];\n        let g = pixels[i+1];\n        let b = pixels[i+2];\n        // CIE luminance for the RGB\n        // The human eye is bad at seeing red and blue, so we de-emphasize them.\n        let v = 0.2126*r + 0.7152*g + 0.0722*b;\n\n        pixels[i] = pixels[i+1] = pixels[i+2] = v * value;\n    }\n\n    return imageData;\n};\n\nfunction drawBackground (color) {\n    ctx.fillStyle = color;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n}\n\nfunction drawCenterPlayButton (color) {\n    ctx.fillStyle = `${color}`;\n    let triangle = {\n        width: 35,\n        height: 50\n    };\n\n    // координаты вершин отцентрированного треугольника\n    triangle.points = {\n        top: {\n            x: (canvas.width - triangle.width) / 2,\n            y: (canvas.height - triangle.height) / 2\n        },\n        bottom: {\n            x: (canvas.width - triangle.width) / 2,\n            y: (canvas.height + triangle.height) / 2\n        },\n        right: {\n            x: (canvas.width + triangle.width) / 2,\n            y: canvas.height / 2\n        },\n    };\n\n    controlElements.push({\n        type: 'start',\n        top: triangle.points.top.y,\n        left: triangle.points.top.x,\n        bottom: triangle.points.bottom.y,\n        right: triangle.points.right.x\n    });\n\n    ctx.beginPath();\n    ctx.moveTo(triangle.points.top.x, triangle.points.top.y);\n    ctx.lineTo(triangle.points.bottom.x, triangle.points.bottom.y);\n    ctx.lineTo(triangle.points.right.x, triangle.points.right.y);\n    ctx.fill();\n}\n\nfunction drawSkratches () {\n    let strokeOpacity = Math.random() * (0.8 - 0.2);\n    // белого цвета с рандомной прозрачностью\n    ctx.strokeStyle = `rgba(255, 255, 255, ${strokeOpacity})`;\n\n    // рисуем царапины только если выпадает 99/100\n    let amountOfSkratches = Math.floor(Math.random() * (100 - 0 + 1));\n    amountOfSkratches -= 98;\n    if(amountOfSkratches > 0){\n        for(let i = 0; i < amountOfSkratches; i++){\n            skratch();\n        }\n    }\n}\n\nfunction skratch () {\n    ctx.beginPath();\n    let startPoint = {\n        x: Math.floor(Math.random() * (canvas.width)),\n        y: Math.floor(Math.random() * (canvas.height))\n    };\n\n    let endPoint = {\n        x: Math.floor(Math.random() * (canvas.height)),\n        y: Math.floor(Math.random() * (canvas.height))\n    };\n\n    ctx.moveTo(startPoint.x, startPoint.y);\n    ctx.lineTo(endPoint.x, endPoint.y);\n    ctx.stroke();\n}\n\nfunction startDrawLoop () {\n    if(!loopId && !isSubtitleShown){\n        loopId = setInterval(drawLoop, fps);\n    } else if (typeof subtitles[subtitleIndex] !== 'undefined') {\n        subTimeout = setTimeout(hideSub, subtitles[subtitleIndex].timeLength / 2);\n    }\n}\n\nfunction stopDrawLoop () {\n    if(loopId) {\n        clearInterval(loopId);\n        loopId = undefined;\n    }\n}\n\nfunction drawLoop () {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n    \n    let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    let imageDataFiltered = grayAndGrain(imageData);\n    ctx.putImageData(imageDataFiltered, 0, 0);\n\n    drawSkratches();\n}\n","linksForm.addEventListener('submit', _onLinksFormSubmit, false);\nlinksFormInputs.forEach((input) => {\n        input.addEventListener('focus', _onInputFocus, false);\n});\n\nfunction _onInputFocus (e) {\n    e.target.setSelectionRange(0, e.target.value.length);\n}\n\nfunction _onLinksFormSubmit (e) {\n    e.preventDefault();\n\n    overlay.show();\n    loader.show();\n\n    let inputs = document.querySelectorAll('.links-form__input');\n    let validation = true;\n\n    inputs.forEach((input) => {\n        if(input.value === ''){\n            validation = false;\n        }\n    });\n\n    if(validation) {\n        Promise.all([\n            createVideo(videoInput.value),\n            createAudio(audioInput.value),\n            createSub(subInput.value)\n        ]).then((res) => {\n            initCanvas();\n            showPlayer();\n\n            subtitles = parseSrt(res[2]);\n\n            loader.hide();\n            overlay.hide();\n        }).catch((err) => {\n            loader.hide();\n            modalAlert.show(`<h4>Error:</h4>${err}`);\n        });\n    } else {\n        loader.hide();\n        overlay.hide();\n    }\n}\n\nfunction createSub (src) {\n    return new Promise((resolve, reject) => {\n        try {\n            let subReq = new XMLHttpRequest();\n\n            subReq.addEventListener('readystatechange', (e) => {\n                if (subReq.readyState === 4 && subReq.status === 200) {\n                    resolve(subReq.responseText);\n                }\n            });\n\n            subReq.open('GET', src, false);\n            subReq.send();\n        } catch (e) {\n            reject(e);\n        }\n    });\n}\n\nfunction createVideo (src) {\n    return new Promise((resolve, reject) => {\n        try {\n            video = document.createElement('video');\n            video.setAttribute('crossorigin', 'anonymous');\n            video.setAttribute('preload', true);\n\n            video.src = corsProxy + src;\n            video.defaultMuted = true;\n            video.style.visibility = 'hidden';\n\n            video.addEventListener('play', startDrawLoop, false);\n\n            video.addEventListener('pause', stopDrawLoop, false);\n\n            video.addEventListener('timeupdate', (e) => {\n                let time = (e.target.currentTime * 1000).toFixed();\n                if (typeof subtitles[subtitleIndex] !== 'undefined' && time >= subtitles[subtitleIndex].endTime) {\n                    if (!isSubtitleShown) {\n                        showSub(subtitles[subtitleIndex]);\n                        startSubTimeout();\n                    }\n                }\n            });\n\n            video.addEventListener('ended', (e) => {\n                audio.pause();\n                stopDrawLoop();\n            }, false);\n\n            video.addEventListener('loadeddata', (e) => {\n                document.querySelector('body').appendChild(video);\n\n                videoSizeRatio = video.videoWidth / video.videoHeight;\n\t\t\t    videoWidth = parseInt(getComputedStyle(video).width).toFixed();\n\t\t\t    videoHeight = videoWidth / videoSizeRatio;\n                video.classList.add('player__video');\n                video.style.display = 'none';\n\n                resolve(video);\n            }, false);\n        } catch(e) {\n            reject(e);\n        }\n    });\n}\n\nfunction createAudio (src) {\n    return new Promise((resolve, reject) => {\n        try {\n            audio = document.createElement('audio');\n            audio.setAttribute('crossorigin', 'anonymous');\n\t        audio.src = corsProxy + src;\n\t        audio.autoplay = false;\n            audio.classList.add('player__audio');\n\n            audio.addEventListener('loadeddata', (e) => {\n                document.querySelector('.hidden-elements').appendChild(audio);\n                resolve(audio);\n            });\n        } catch(e) {\n            reject(e);\n        }\n    });    \n}\n","function parseSrt (text) {\n    let timeConst = {\n        sec: 1000,\n        min: 60,\n        hr: 60\n    };\n    let temp = text.split('\\n\\n');\n\n    let result = temp.map((el) => {\n        let res = {};\n        let subtitle = el.split('\\n');\n\n        // === Get subtitle's number ===\n        res.number = parseInt(subtitle[0]);\n\n        let time = subtitle[1].split(' --> ');\n\n        // === Convert start time to MS ===\n        let startTime = time[0].split(':');\n        let startTimeSec = parseInt(startTime[2].split(',').join(''));\n        let startTimeMin = parseInt(startTime[1]) * timeConst.min * timeConst.sec;\n        let startTimeHr = parseInt(startTime[0]) * timeConst.hr * timeConst.min * timeConst.sec;\n        startTime = startTimeSec + startTimeMin\t+ startTimeHr;\n        res.startTime = startTime;\n\n        // === Convert end time to MS ===\n        let endTime = time[1].split(':');\n        let endTimeSec = parseInt(endTime[2].split(',').join(''));\n        let endTimeMin = parseInt(endTime[1]) * timeConst.min * timeConst.sec;\n        let endTimeHr = parseInt(endTime[0]) * timeConst.hr * timeConst.min * timeConst.sec;\n        endTime = endTimeSec + endTimeMin\t+ endTimeHr;\n        res.endTime = endTime;\n\n        res.timeLength = endTime - startTime;\n\n        // === Join subtitle content ===\n        subtitle.splice(0, 2);\n        res.content = subtitle;\n\n        return new Subtitle(res);\n    });\n\n    return result;\n}\n\nfunction Subtitle(data) {\n    this.startTime = data.startTime;\n    this.endTime = data.endTime;\n    this.content = data.content;\n    this.timeLength = data.timeLength;\n}\n\nfunction showSub (sub) {\n    isSubtitleShown = true;\n\n    video.pause();\n    drawSub(sub);\n}\n\nfunction drawSub (sub) {\n    ctx.fillStyle = 'black';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = 'white';\n    ctx.font = `${canvasFontSize}px Oranienbaum, serif`;\n\n    let textHeight = (sub.content.length * canvasFontSize) + ((sub.content.length - 1) * canvasLineHeight);\n    let topPadding = (canvas.height - textHeight) / 2;\n\n    sub.content.forEach((el, i) => {\n        let top = topPadding + (canvasFontSize * i) + (canvasLineHeight * i);\n        let left = (canvas.width * 0.1);\n        ctx.fillText(el, left, top);\n    }); \n}\n\nfunction hideSub () {\n    if (isSubtitleShown) {\n        isSubtitleShown = false;\n        subtitleIndex++;\n        video.play();\n    }\n    clearTimeout(subTimeout);\n    subTimeout = undefined;\n    controlElements = [];\n    createPauseElement();\n}\n\nfunction stopSubTimeout () {\n    if(subTimeout) {\n        clearTimeout(subTimeout);\n        subTimeout = undefined;\n    }\n}\n\nfunction startSubTimeout () {\n    subTimeout = setTimeout(hideSub, subtitles[subtitleIndex].timeLength);\n}\n"],"sourceRoot":"/source/"}